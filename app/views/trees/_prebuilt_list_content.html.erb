<% jobs.each do |j| %>
  <% ul = UploadedList.find_by_lid(j["list_id"]) %>
  <div id="job-content-<%= ul.class.name %>-<%= ul.id %>" class="hide">
    <table class="table">
      <tr>
        <th>List title</th>
        <td><%= j["list_title"] %></td>
      </tr>
      <tr>
        <th>File</th>
        <th><%= ul.file.original_filename %></th>
      </tr>
        <th>Created at</th>
        <td><%= ul.created_at %></td>
      </tr>
      <tr>
        <th>Modified at</th>
        <td><%= ul.updated_at %></td>
      </tr>
      <tr>
        <th>Available Action</th>
        <td>
          <% case type %>
          <% when 1 %>
            <%= link_to "Create new tree", uploaded_list_path(id: j["list_id"]), class: "btn btn-primary" %>
            <%= link_to "Remove", uploaded_list_path(ul.id), method: :delete, class: "btn btn-danger", data: {confirm: "Removing a job will also delete all trees belonging to that job. Are you sure?"} %>
            
          <% when 2 %>
            <%= link_to "Create new tree", uploaded_list_path(id: j["list_id"]), class: "btn btn-primary" %>
            <%= form_for(current_user.user_list_relationships.find_by(uploaded_list_id: ul.id), html: { method: :delete }) do |f| %>
              <%= f.submit "Remove", class: "btn btn-danger", style: "margin-top: 5px;", data: { confirm: "Removing a job will also delete all trees belonging to that job. Are you sure?" } %>
            <% end %>

          <% when 3 %>          
            <%= link_to "Re-upload", "#", "data-toggle": "modal", "data-target": "#reup-#{ul.id}", class: "btn btn-primary" %>
            <%= link_to "Remove", uploaded_list_path(ul.id), method: :delete, class: "btn btn-danger", data: {confirm: "Removing a job will also delete all trees belonging to that job. Are you sure?"} %>
            <div class="modal fade" id="reup-<%= ul.id %>" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header"> 
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button> 
                    <h3 class="modal-title center" id="myModalLabel">Re-upload</h3>
                  </div>
                  <%= form_for ul, url: uploaded_list_path(ul.id), method: :patch, html: { multipart: true } do |f| %>
                    <div class="modal-body">
                      <div class="form-group">
                        <%= f.file_field :file, class: "input-file" %>
                        <div>Note: please compress your files in one ZIP file. You can find a default template <%= link_to "here", "https://drive.google.com/file/d/0B7SKJwE3SsCsNUhYQWdEVzk2RFE/view?usp=sharing"%></div>
      
                        <%= f.label :public do %>
                          <%= f.check_box :public, class: "input-file" %>
                          Allow others to watch this list
                        <% end %>
      
                      </div>
                    </div>
                    <div class="modal-footer"> 
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> 
                      <%= f.submit "Submit my list", class: "btn btn-default btn-primary" %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </td>
      </tr>
    </table>
    
    <% if type != 3 %>
      <%= render partial: "trees/trees_of_job", locals: {j: ul} %>
    <% end %>
  </div>
<% end %>
