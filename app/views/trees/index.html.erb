<%= javascript_include_tag 'http://phylo.cs.nmsu.edu:8080/TreeViewer/demo/ete_dev.js' %>

<% provide(:title, "Tree Viewer") %>

<div class="row">
  <% if user_signed_in? %>
    <div class="col-md-4">
      <div class="list-selection">
        <div class="row">
          <div class="col-md-4">
            <h4 class="fix-heading">My Trees</h4>
          </div>
          <div class="col-md-6">
      	    <div class="my-trees">
              <div class="dropdown">
                <button class="btn btn-default dropdown-toggle treeMenuDropbox" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                  Select a tree
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu tree-menu">
                  <div class="table-wrapper">
                    <div class="table-scroll">  
                      <div class="nav nav-stacked">
                      <% @my_trees.each do |t| %>
                        <% name = t.name.to_s == '' ? "*no name*" : t.name %>
                        <% case t.status %>
                        <% when "completed" %>
                          <li><%= link_to name, tree_path(t.id), remote: true, class:"", id: "nav-tree-#{t.id}" %></li>
                        <% when "unsuccessfully-constructed" %>
                          <li><%= link_to(name, tree_path(t.id), remote: true, class:"", id: "nav-tree-#{t.id}") %></li>
                        <% when nil %>
                          <!--Solr is denied to create tree but sidekiq still queued the tree -->
                        <% end %>
                      <% end %>
                    </div>
                    </div>
                  </div>
                </ul>
              </div>
            </div>
    	    </div>
        </div>
      </div>
    </div>
  <% end %>
  <div class="col-md-4">
    <div class="list-selection">
      <div class="row">
        <div class="col-md-5">
          <h4 class="fix-heading">Public Trees</h4>
        </div>
        <div class="col-md-6">
          <div class="public-trees">
            <div class="dropdown">
              <button class="btn btn-default dropdown-toggle treeMenuDropbox" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                Select a tree
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu tree-menu">
                <div class="table-wrapper">
                  <div class="table-scroll">  
                    <div class="nav nav-stacked">
                      <% @public_trees.each do |t| %>
                        <% name = t.name.to_s == '' ? "*no name*" : t.name %>
                        <% case t.status %>
                        <% when "completed" %>
                          <li><%= link_to name, tree_path(t.id), remote: true, class:"", id: "nav-tree-#{t.id}" %></li>
                        <% when "unsuccessfully-constructed" %>
                          <li><%= link_to(name, tree_path(t.id), remote: true, class:"", id: "nav-tree-#{t.id}") %></li>
                        <% when nil %>
                          <!--Solr is denied to create tree but sidekiq still queued the tree -->
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<hr style="margin-top: 0; margin-bottom: 5px;">
<div>
  <div class="row" id="tree-content">
  </div>
</div>

<script>
$(document).ready(function() {
  $(".list-group-item").click(function() {
    $(".list-group-item").removeClass("active");
    $(this).addClass("active");
    $('#ra-content').html("<div class='center'><img src='<%= image_path("loading-icon.gif") %>'></div>");
  })

  $('a[id*="nav-tree-"]').click(function() {
    $(this).parent().addClass("active");
    $(".treeMenuDropbox").html("Select a tree <span class='caret'></span>");
    if($(this).parents(".dropdown").parent().attr("class") == "my-trees") {      
      $(".my-trees .treeMenuDropbox").text($(this).text());
    } else {      
      $(".public-trees .treeMenuDropbox").text($(this).text());
    }
  });

  $("#nav-tree-" + "<%= @inspect %>").click();
  
  navigator.sayswho= (function(){
      var ua= navigator.userAgent, tem, 
      M= ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
      if(/trident/i.test(M[1])){
          tem=  /\brv[ :]+(\d+)/g.exec(ua) || [];
          return 'IE '+(tem[1] || '');
      }
      if(M[1]=== 'Chrome'){
          tem= ua.match(/\b(OPR|Edge)\/(\d+)/);
          if(tem!= null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
      }
      M= M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
      if((tem= ua.match(/version\/(\d+)/i))!= null) M.splice(1, 1, tem[1]);
      return M.join(' ');
  })();
  
  if(navigator.sayswho == "Safari 9") {
    $('#ra-content').html("<div class='center'>Browser version is not supported, please upgrade to Safari 10 or use Chrome instead</div>");
  }
})
</script>



