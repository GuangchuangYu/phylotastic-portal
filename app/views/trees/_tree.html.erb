<% tree_newick = sanitize_newick(tree) %>
<div class="row">
  <div class="col-md-10">
    <div id="tree-in-newick"></div>
    
    <div id='popup'></div>
    <h3>Tree Actions</h3>
    <div class="row tree-wrapper">
      <div class="col-md-6">
        <div class="row">
          <div class="col-md-4">Line width:</div>
          <div class="col-md-8">
            <input type="radio" name="lwidth" value="1" checked="checked">1
            <input type="radio" name="lwidth" value="2">2
            <input type="radio" name="lwidth" value="3">3
            <input type="radio" name="lwidth" value="4">4
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">Line Color:</div>
          <div class="col-md-8">
            <input type="text" name="color" value="" size="20">
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">Ladderize Tree:</div>
          <div class="col-md-8">
            <input type="checkbox" id="ladderize">
          </div>
        </div>
        <input type="submit" value="Apply" onclick="run_tree_action();">
      </div>
      
      <div class="col-md-6">
        <div class="row">
          <div class="col-md-4">Image format: </div>
          <div class="col-md-8">
            <input type="radio" name="format" value="png" checked="checked">png
            <input type="radio" name="format" value="svg">svg
          </div>
        </div>
        <input type="submit" value="Generate image link for download" onclick="save_tree_image();">
        <div id="svg_image"></div>
      </div>
    </div>
    <div id='img1' class="ete_image"></div>


    <div>
      <div class="pull-right" style="font-size: 80%;">Last edited: <%= time_ago_in_words(tree.updated_at) %> by <%= link_to tree.user.name, '#' %></div>
    </div>
  </div>
  
  <!-- Modal -->
  <div class="modal fade" id="show-tree-format" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body">
          <textarea style="word-break: break-all; min-height: 300px;" id="tree-in-string-format" disabled class="form-control"><%= tree_newick %></textarea>
        </div>
        <div class="modal-footer">
          <div class="btn-group" role="group" aria-label="...">
            <div class="btn-wrapper">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
            <div class="btn-wrapper">
              <button type="button" class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Copy to clipboard" id="copy-to-clipboard" data-clipboard-target="#tree-in-string-format" data-clipboard-action="copy">Copy</button>
            </div>
            <div class="dropdown btn-wrapper">
              <button class="btn btn-primary dropdown-toggle" type="button" id="dropdown-export-newick" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                Export as TXT
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdown-export-newick">
                <li>
                  <%= link_to "WITH ottids", newick_trees_path(format: :txt, id: tree.id, ott: true) %> 
                </li>
                <li>
                  <%= link_to "WITHOUT ottids", newick_trees_path(format: :txt, id: tree.id, ott: false) %>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-2">
    <div class="row">
      <!-- <h4 class="center" id="tree-actions">Tree actions</h4> -->

      <!-- Button trigger modal -->
      <button type="button" class="btn btn-default btn-block" data-toggle="modal" data-target="#show-tree-format">
        Newick
      </button>
  
      <!-- Add to gallery btn -->
      <%= render 'watch_relationships/watch_form' unless current_user.nil? %>
  
      <!-- <% if tree.user == current_user %>
        <% if !tree.public && tree.status == "completed" %>
          <div id="publicise-btn">
            <%= form_for(tree, url: public_trees_path, remote: true, html: {id: "publicise-tree"}) do |f| %>
              <div><%= hidden_field_tag "tree[public]", true %></div>
              <%= f.submit "Publish to Community", class: "btn btn-block btn-primary" %>
            <% end %>
          </div>
        <% end %>
        <%= link_to "Save tree view", "#", class: "btn btn-default btn-block", id: "save-to-server" %>
      <% end %> -->
  
      <!-- <%= form_tag "/trees/generate_image.svg", method: :post, id: "save-to-disk-form" do %>
        <input type="hidden" name="image" value="" />
      <% end %>
      <%= link_to "Save tree to disk", "#", class: "btn btn-default btn-block", id: "save-to-disk", style: "margin-top:7px;" %> -->
	
  	  <!-- Button trigger modal -->
  	  <a class="btn btn-default btn-block" data-toggle="modal" data-target="#edit-tree-name-modal-<%= tree.id %>" href="#" style="margin-bottom: 7px;">Edit tree name</a>
  	  <!-- Modal -->
  	  <div class="modal fade" id="edit-tree-name-modal-<%= tree.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  	    <div class="modal-dialog" role="document">
  	      <div class="modal-content">
            <%= form_for tree, remote: true do |f| %>
  	          <div class="modal-header">
  	            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
  	            <h4 class="modal-title" id="myModalLabel">Enter a new name for this tree</h4>
  	          </div>
  	          <div class="modal-body">
  	            <%= f.text_field :name, value: tree.name, class: "form-control" %>
  	          </div>
  	          <div class="modal-footer">
  	            <%= f.submit "Change", class: "btn btn-primary", style: "margin-bottom: 10px;" %>
  	          </div>
            <% end %>
          </div>
        </div>
      </div>
    
      <%= form_for(tree, html: { method: :delete }) do |f| %>
        <%= f.submit "Delete", class: "btn btn-danger btn-block", data: { confirm: 'Are you sure?' } %>
      <% end %>
    </div>  

  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="show-tree-image" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel"></h4>
      </div>
      <div class="modal-body center">
        <%= image_tag tree.image.url, width: "100%" %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function() {
  get_tree_image("<%= tree_newick %>", "#img1");
})
</script>